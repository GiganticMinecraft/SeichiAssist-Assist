# Scalaの基本

## はじめに

SeichiAssistでは、プログラムのコードを書くために[Scala](https://docs.scala-lang.org/ja/)を使っています。本項では、SeichiAssistで主に使われるScalaの機能等を紹介します。

### 読み方

次のように書かれる「コードスニペット」は、(特に明記が無い限りScala)で書かれたコードを含みます：

```Scala
val variable = 42
```

Scalaのコードスニペットは、すべて[Scastie](https://scastie.scala-lang.org/)というオンライン実行環境で試せるものになります。コードを貼り付けてSaveボタンを押せば実行できます。少し変えて動かしてみて、予想通りの結果になるか試してみるのも良いでしょう。

`abc123` のようにフォントが切り替わっている箇所は、コードスニペットにするには短いコードの一部分のみを切り取ってきたことを表します。

「注: 」と書かれている箇所は読むことが推奨されている注釈です。

「補足: 」と書かれている箇所は、疑問に思われるかもしれない箇所や、正確性に欠ける記述を補足するものです。よくわからない場合は飛ばしても構いません。

## 値、変数、型

### 値

Scalaでプログラムを書くにあたって最も基本的なものとも言える存在が「値」です。値を厳密に定義するのはここでは難しいですが、以下のようなものが含まれます：

 - 「整数」値
   - `0`, `-10`, `42`
 - 「文字列」値
   - `"abc"`, `"あいうえお"`, `Scala`
 - 「小数部分を持つ数」値
   - `0.3`, `-1.5`
     - 補足: 実は、コンピュータの内部的な事情によりこれらの値は私たちが思ったように正確に表されているとは限りません。 `0.1 + 0.2` はしばしば `0.3` とは違う値を返してきます！詳しくは、「浮動小数点数　誤差」などと検索してみてください。
 - 「時刻」値
   - 2020年9月3日14時15分
     - 注: これをこのままプログラムに書いても動きません！プログラムは、この特定の時刻を指し示すより具体的な値(例えば1970年1月1日 00:00:00 UTCからの経過秒数など)を扱います。

### 変数

Scalaでは `1 + 3`(加算), `2 * 21`(掛け算)のように整数値の計算をすることができます。 

計算をした結果を後で別の計算や処理に使いたいという状況はよく発生するのですが、Scalaでは「変数」と呼ばれる仕組みでこれを実現できます。変数を作成する(補足: "宣言する"と言います)には、 `val ` の後に「変数の名前」を書き、変数が持っておいて欲しい結果を ` = ` で繋ぎます。

```Scala
val firstValue = 3
val secondValue = firstValue * firstValue + 1
```

これで、 `secondValue` は `10` を持つことになります。Scastieは最後の式の値を表示してくれるので、

```Scala
val firstValue = 3
val secondValue = firstValue * firstValue + 1

secondValue
```

と入力すると、 `secondValue` の隣に `10: Int` という表示が出ます。

### 型

さて、上で挙げた値達は、何らかの「種類」のようなものに分けられています。大雑把に言えば、「値、変数や式がどんな種類であるか」の情報が「型」そのものです。

例えば`0`は`Int`(注: integer; 整数)という型を持ちますし、`"abc"`は`String`という型を持ちます。Scalaには様々な型があり、型は予期しない値がプログラムのとある箇所から別の箇所へ渡されてしまうことを防ぐ役割があります。

変数の型は明示的に書くことができます：

```Scala
val integerValue: Int = 42
```

以下のコードは実行することを許してくれません(Scastieに入れてみると、エラーが出ることでしょう)

```
val integerExpected: Int = "42"
```

Scalaの特別な型として `Any` 型というものがあります。これは「どのような種類の値になるか一切わからない」ことを示す型であり、何らかの複雑な理由で適切な種類分けができない時には `Any` が書かれます。

注: 厳密には今の型の説明は不十分です。ここで言う型とは「値、変数や式がどのような種類であることを期待されているか」という、プログラムが実行されるより遥か前に分かっている情報です。コードがコンピュータによって実行しやすい形式にすることを「コンパイルする」、コンパイルするプログラムのことを「コンパイラ」と呼びます。コンパイラは式の型を算出し、変数に本当にその式の値を入れるのが**安全かどうか**を検査します。この仕組みは __型システム__ と呼ばれ、プログラムを走らせたときに値にくっつけられる「値がどのような種類であるか」という情報である「型タグ」とは区別されます。例えば、Scastieで表示された `secondValue [10: Int]` のような表示は「型タグ」によるものです。

## オブジェクト

Scalaの値には「オブジェクト」というものがあります。オブジェクトは複数の値を一つの値として束ねたものです。

オブジェクトは、`new` キーワードにより作成でき、束ねる値として「プロパティ」を持つことができます。

`new` で作っただけのオブジェクトを変数に入れようとする時、何もしないならば型に `Any` を指定するしかありません。これだとプロパティに安全にアクセスすることができない(補足: 実はできるが実行が遅い)ため、先に `trait` として型を定義する必要があります。オブジェクトがとある `trait` の型を持つことは明示的に宣言する必要があり、 `new` の直後にtrait名を書くことができます。

次のコードはオブジェクトの型を定義し、定義した型を持つオブジェクトを `new` で作成し `myObject` に持たせ、最後に `integerProperty` を取り出しています。 `//` から始まる箇所はコード上無視される「コメント」です。

```Scala
// 型を定義する
trait MyObjectType {
  val integerProperty: Int
  
  val stringProperty: String
}

// 新しいオブジェクトを作成し、myObjectに持たせる
val myObject: MyObjectType = new MyObjectType {
  val integerProperty = 123
  
  val stringProperty = "abc"
}

// プロパティの値を取り出す
myObject.integerProperty
```
 
TODO: メソッドに関する説明

## 関数、関数オブジェクト、関数の型

## `class`、`class`による型、`class`のインスタンス化

## コレクション

## 抽象クラス

## 多相性、多相的な定義
